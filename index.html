<!DOCTYPE html>
<html>
<head>
    <title>Gestion Stock Mobile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* Reset mobile */
        * {
            -webkit-text-size-adjust: 100%;
            touch-action: manipulation;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 15px 10px 70px;
            background: #f5f7fa;
            font-size: 16px;
        }
        
        /* Navigation mobile */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #3498db;
            display: flex;
            padding: 10px 5px;
            z-index: 100;
        }
        
        .mobile-nav button {
            flex: 1;
            background: none;
            border: none;
            color: white;
            padding: 10px;
            font-size: 14px;
        }
        
        /* Sections */
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        /* Formulaires */
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        /* Boutons */
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            width: 100%;
            font-size: 16px;
            margin: 10px 0;
        }
        
        .btn-danger {
            background: #e74c3c;
            padding: 8px 12px;
            width: auto;
        }
        
        /* Tableaux */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }
        
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        
        th {
            background: #3498db;
            color: white;
        }
    </style>
</head>
<body>

<!-- Navigation Mobile -->
<div class="mobile-nav">
    <button onclick="showSection('resume')">Résumé</button>
    <button onclick="showSection('achats')">Achats</button>
    <button onclick="showSection('ventes')">Ventes</button>
    <button onclick="showSection('stock')">Stock</button>
</div>

<!-- Section Résumé -->
<div id="resume" class="section active">
    <h2>Résumé</h2>
    <div style="background:white; padding:15px; border-radius:8px; margin:10px 0;">
        <p><b>Aujourd'hui :</b> <span id="benef-jour">0€</span></p>
        <p><b>7 derniers jours :</b> <span id="benef-semaine">0€</span></p>
        <p><b>Ce mois-ci :</b> <span id="benef-mois">0€</span></p>
    </div>
</div>

<!-- Section Achats -->
<div id="achats" class="section">
    <h2>Nouvel Achat</h2>
    <div class="form-group">
        <label>Article :</label>
        <input type="text" id="achat-article" placeholder="Pull Zara">
    </div>
    <div class="form-group">
        <label>Prix unitaire (€) :</label>
        <input type="number" id="achat-prix" step="0.01" placeholder="20.00">
    </div>
    <div class="form-group">
        <label>Quantité :</label>
        <input type="number" id="achat-quantite" value="1" min="1">
    </div>
    <div class="form-group">
        <label>Frais de livraison (€) :</label>
        <input type="number" id="achat-livraison" step="0.01" placeholder="5.00">
    </div>
    <div class="form-group">
        <label>Date :</label>
        <input type="date" id="achat-date">
    </div>
    <button class="btn" onclick="ajouterAchat()">Enregistrer</button>
    
    <h2>Historique</h2>
    <table id="tableau-achats">
        <thead>
            <tr>
                <th>Date</th>
                <th>Article</th>
                <th>Prix</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- Section Ventes -->
<div id="ventes" class="section">
    <h2>Nouvelle Vente</h2>
    <div class="form-group">
        <label>Article :</label>
        <select id="vente-article"></select>
        <small id="stock-disponible" style="color:#3498db;"></small>
    </div>
    <div class="form-group">
        <label>Prix de vente (€) :</label>
        <input type="number" id="vente-prix" step="0.01" placeholder="50.00">
    </div>
    <div class="form-group">
        <label>Quantité :</label>
        <input type="number" id="vente-quantite" value="1" min="1">
    </div>
    <div class="form-group">
        <label>Date :</label>
        <input type="date" id="vente-date">
    </div>
    <button class="btn" onclick="ajouterVente()">Enregistrer</button>
    
    <h2>Historique</h2>
    <table id="tableau-ventes">
        <thead>
            <tr>
                <th>Date</th>
                <th>Article</th>
                <th>Prix</th>
                <th>Bénéfice</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- Section Stock -->
<div id="stock" class="section">
    <h2>Stock Actuel</h2>
    <table id="tableau-stock">
        <thead>
            <tr>
                <th>Article</th>
                <th>Quantité</th>
                <th>Prix</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
    // Données
    let achats = JSON.parse(localStorage.getItem('achats')) || [];
    let ventes = JSON.parse(localStorage.getItem('ventes')) || [];
    let nextId = Math.max(0, ...achats.map(a => a.id || 0), ...ventes.map(v => v.id || 0)) + 1;

    // Navigation
    function showSection(sectionId) {
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
        });
        document.getElementById(sectionId).classList.add('active');
    }

    // Ajout d'achat
    function ajouterAchat() {
        const article = document.getElementById('achat-article').value.trim();
        const prix = parseFloat(document.getElementById('achat-prix').value);
        const quantite = parseInt(document.getElementById('achat-quantite').value);
        const livraison = parseFloat(document.getElementById('achat-livraison').value) || 0;
        const date = document.getElementById('achat-date').value;

        if (!article || isNaN(prix) || isNaN(quantite) || !date) {
            alert("Remplis tous les champs !");
            return;
        }

        const prixReel = prix + (livraison / quantite);

        achats.push({
            id: nextId++,
            article,
            prix: prixReel,
            prixInitial: prix,
            fraisLivraison: livraison,
            quantite,
            date
        });

        localStorage.setItem('achats', JSON.stringify(achats));
        actualiserDonnees();
        document.getElementById('achat-article').value = '';
        document.getElementById('achat-prix').value = '';
        document.getElementById('achat-quantite').value = 1;
        document.getElementById('achat-livraison').value = '';
        showSection('achats');
    }

    // Ajout de vente
    function ajouterVente() {
        const article = document.getElementById('vente-article').value;
        const prix = parseFloat(document.getElementById('vente-prix').value);
        const quantite = parseInt(document.getElementById('vente-quantite').value);
        const date = document.getElementById('vente-date').value;

        if (!article || isNaN(prix) || isNaN(quantite) || !date) {
            alert("Remplis tous les champs !");
            return;
        }

        if (calculerStock(article) < quantite) {
            alert(`Stock insuffisant ! Il reste ${calculerStock(article)} ${article}`);
            return;
        }

        ventes.push({
            id: nextId++,
            article,
            prix,
            quantite,
            date
        });

        localStorage.setItem('ventes', JSON.stringify(ventes));
        actualiserDonnees();
        document.getElementById('vente-prix').value = '';
        document.getElementById('vente-quantite').value = 1;
        showSection('ventes');
    }

    // Calcul du stock
    function calculerStock(article) {
        const totalAchats = achats
            .filter(a => a.article === article)
            .reduce((sum, a) => sum + a.quantite, 0);
            
        const totalVentes = ventes
            .filter(v => v.article === article)
            .reduce((sum, v) => sum + v.quantite, 0);
            
        return totalAchats - totalVentes;
    }

    // Suppression
    function supprimerElement(type, id) {
        if (!confirm("Supprimer cet élément ?")) return;
        
        if (type === 'achat') {
            achats = achats.filter(a => a.id !== id);
            localStorage.setItem('achats', JSON.stringify(achats));
        } else {
            ventes = ventes.filter(v => v.id !== id);
            localStorage.setItem('ventes', JSON.stringify(ventes));
        }
        
        actualiserDonnees();
    }

    // Actualisation interface
    function actualiserDonnees() {
        // Stock
        const tbodyStock = document.querySelector('#tableau-stock tbody');
        tbodyStock.innerHTML = '';
        
        const articles = [...new Set(achats.map(a => a.article))];
        articles.forEach(article => {
            const stock = calculerStock(article);
            if (stock > 0) {
                const achat = achats.find(a => a.article === article);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${article}</td>
                    <td>${stock}</td>
                    <td>${achat.prix.toFixed(2)}€</td>
                    <td><button class="btn-danger" onclick="supprimerArticle('${article}')">×</button></td>
                `;
                tbodyStock.appendChild(tr);
            }
        });
        
        // Historique achats
        const tbodyAchats = document.querySelector('#tableau-achats tbody');
        tbodyAchats.innerHTML = '';
        achats.forEach(achat => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${achat.date}</td>
                <td>${achat.article}</td>
                <td>${achat.prix.toFixed(2)}€</td>
                <td><button class="btn-danger" onclick="supprimerElement('achat', ${achat.id})">×</button></td>
            `;
            tbodyAchats.appendChild(tr);
        });
        
        // Historique ventes
        const tbodyVentes = document.querySelector('#tableau-ventes tbody');
        tbodyVentes.innerHTML = '';
        ventes.forEach(vente => {
            const achat = achats.find(a => a.article === vente.article);
            const benefice = achat ? (vente.prix - achat.prix) * vente.quantite : 0;
            
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${vente.date}</td>
                <td>${vente.article}</td>
                <td>${vente.prix.toFixed(2)}€</td>
                <td style="color:${benefice >= 0 ? 'green' : 'red'}">${benefice.toFixed(2)}€</td>
                <td><button class="btn-danger" onclick="supprimerElement('vente', ${vente.id})">×</button></td>
            `;
            tbodyVentes.appendChild(tr);
        });
        
        // Liste déroulante articles
        const select = document.getElementById('vente-article');
        select.innerHTML = '';
        articles.forEach(article => {
            if (calculerStock(article) > 0) {
                const option = document.createElement('option');
                option.value = article;
                option.textContent = `${article} (${calculerStock(article)} dispo)`;
                select.appendChild(option);
            }
        });
        
        // Résumé financier
        updateResume();
    }
    
    function supprimerArticle(article) {
        if (!confirm(`Supprimer TOUS les "${article}" ?`)) return;
        
        achats = achats.filter(a => a.article !== article);
        ventes = ventes.filter(v => v.article !== article);
        localStorage.setItem('achats', JSON.stringify(achats));
        localStorage.setItem('ventes', JSON.stringify(ventes));
        actualiserDonnees();
    }
    
    function updateResume() {
        const aujourdhui = new Date().toISOString().split('T')[0];
        const date7Jours = new Date();
        date7Jours.setDate(date7Jours.getDate() - 7);
        
        let benefJour = 0;
        let benefSemaine = 0;
        let benefMois = 0;
        
        ventes.forEach(vente => {
            const achat = achats.find(a => a.article === vente.article);
            const benefice = achat ? (vente.prix - achat.prix) * vente.quantite : 0;
            
            if (vente.date === aujourdhui) benefJour += benefice;
            if (new Date(vente.date) >= date7Jours) benefSemaine += benefice;
            if (new Date(vente.date).getMonth() === new Date().getMonth()) benefMois += benefice;
        });
        
        document.getElementById('benef-jour').textContent = benefJour.toFixed(2) + '€';
        document.getElementById('benef-semaine').textContent = benefSemaine.toFixed(2) + '€';
        document.getElementById('benef-mois').textContent = benefMois.toFixed(2) + '€';
    }

    // Initialisation
    document.addEventListener('DOMContentLoaded', () => {
        actualiserDonnees();
        showSection('resume');
    });
</script>
</body>
</html>